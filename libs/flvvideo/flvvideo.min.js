var egret;(function(a){var b;(function(b){var c=c||0,d=function(b){function d(c,d){void 0===d&&(d=!0);var e=b.call(this)||this;return e.heightSet=NaN,e.widthSet=NaN,e.userPause=!1,e.userPlay=!1,e.isPlayed=!1,e.$renderNode=new a.sys.BitmapNode,e.once(a.Event.ADDED_TO_STAGE,e.loadPoster,e),c&&e.load(),e}return __extends(d,b),d.prototype.createNativeDisplayObject=function(){this.$nativeDisplayObject=new egret_native.NativeDisplayObject(1)},d.prototype.load=function(b,d){var e=this;void 0===d&&(d=!0),b||a.$error(3002),this.src=b;var f,g=this.videoCanvasId||"videoCanvas"+c++;if(!this.videoCanvas||!this.player){f=document.createElement("canvas"),f.id=g,f.width=640,f.height=360,f.style.display="none",this.videoCanvas=f,this.videoCanvasId=g,document.body.appendChild(f),this.player&&this.player.stop();var h=new WFPlayer;WFPlayer.debug(!1),h.enableAudio(!0),h.setView(g),h.setScaleMode(1),h.setBufferTime(1e3),e.startFunc1=function(){h.stop(),this.playTimeoutId&&(clearTimeout(this.playTimeoutId),this.playTimeoutId=null),this.playTimeoutId=setTimeout(()=>{h.start(b),a.startTick(this.markDirty,this)},500)},e.stopFunc1=function(){h.stop(),this.playTimeoutId&&(clearTimeout(this.playTimeoutId),this.playTimeoutId=null),a.stopTick(this.markDirty,this)},this.player=h}},d.prototype.play=function(){this.userPause=!1,this.userPlay=!0,this.isPlayed=!0,this.startFunc1()},d.prototype.stop=function(){this.userPause=!0,this.userPlay=!1,this.stopFunc1();const a=this.videoCanvas.getContext("webgl");a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT),this.markDirty()},d.prototype.reset=function(){this.stop()},Object.defineProperty(d.prototype,"volume",{get:function(){return this.video?this.video.volume:1},set:function(a){this.video&&(this.video.volume=a)},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"canvasElement",{get:function(){return this.videoCanvas?this.videoCanvas:null},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"bitmapData",{get:function(){return this.isPlayed?(this._bitmapData||(this._bitmapData=new a.BitmapData(this.videoCanvas),this._bitmapData.$deleteSource=!1),this._bitmapData):null},enumerable:!0,configurable:!0}),d.prototype.loadPoster=function(){var b=this,c=this.poster;if(c){var d=new a.ImageLoader;d.once(a.Event.COMPLETE,function(){d.data;if(b.posterData=d.data,b.$renderDirty=!0,b.posterData.width=b.getPlayWidth(),b.posterData.height=b.getPlayHeight(),a.nativeRender){var c=new a.Texture;c._setBitmapData(b.posterData),b.$nativeDisplayObject.setTexture(c)}},this),d.load(c)}},d.prototype.$measureContentBounds=function(a){var b=this.bitmapData,c=this.posterData;b?a.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):c?a.setTo(0,0,this.getPlayWidth(),this.getPlayHeight()):a.setEmpty()},d.prototype.getPlayWidth=function(){return isNaN(this.widthSet)?this.bitmapData?this.bitmapData.width:this.posterData?this.posterData.width:NaN:this.widthSet},d.prototype.getPlayHeight=function(){return isNaN(this.heightSet)?this.bitmapData?this.bitmapData.height:this.posterData?this.posterData.height:NaN:this.heightSet},d.prototype.$updateRenderNode=function(){var b=this.$renderNode,c=this.bitmapData,d=this.posterData,e=this.getPlayWidth(),f=this.getPlayHeight();this.isPlayed&&c?c&&(b.image=c,b.imageWidth=c.width,b.imageHeight=c.height,a.WebGLUtils.deleteWebGLTexture(c.webGLTexture),c.webGLTexture=null,b.drawImage(0,0,c.width,c.height,0,0,e,f)):(b.image=d,b.imageWidth=e,b.imageHeight=f,b.drawImage(0,0,d.width,d.height,0,0,e,f))},d.prototype.markDirty=function(){return this.$renderDirty=!0,!0},d.prototype.$setHeight=function(a){if(this.heightSet=a,this.userPause){var c=this;this.$renderDirty=!0,window.setTimeout(function(){c.$renderDirty=!1},200)}b.prototype.$setHeight.call(this,a)},d.prototype.$setWidth=function(a){if(this.widthSet=a,this.userPause){var c=this;this.$renderDirty=!0,window.setTimeout(function(){c.$renderDirty=!1},200)}b.prototype.$setWidth.call(this,a)},Object.defineProperty(d.prototype,"paused",{get:function(){return this.userPause},enumerable:!0,configurable:!0}),d.$videoIndex=d.$videoIndex||0,d}(a.DisplayObject);b.WebFlvVideo=d,__reflect(d.prototype,"egret.web.WebFlvVideo",["egret.FlvVideo","egret.DisplayObject"]),a.FlvVideo=d})(b=a.web||(a.web={}))})(egret||(egret={}));