namespace we {
  export namespace ro {
    export class TableLayer extends we.ui.TableLayer {
      // group
      protected _direct_0_group: eui.Group;
      protected _direct_1_group: eui.Group;
      protected _direct_2_group: eui.Group;
      protected _direct_3_group: eui.Group;
      protected _direct_4_group: eui.Group;
      protected _direct_5_group: eui.Group;
      protected _direct_6_group: eui.Group;
      protected _direct_7_group: eui.Group;
      protected _direct_8_group: eui.Group;
      protected _direct_9_group: eui.Group;
      protected _direct_10_group: eui.Group;
      protected _direct_11_group: eui.Group;
      protected _direct_12_group: eui.Group;
      protected _direct_13_group: eui.Group;
      protected _direct_14_group: eui.Group;
      protected _direct_15_group: eui.Group;
      protected _direct_16_group: eui.Group;
      protected _direct_17_group: eui.Group;
      protected _direct_18_group: eui.Group;
      protected _direct_19_group: eui.Group;
      protected _direct_20_group: eui.Group;
      protected _direct_21_group: eui.Group;
      protected _direct_22_group: eui.Group;
      protected _direct_23_group: eui.Group;
      protected _direct_24_group: eui.Group;
      protected _direct_25_group: eui.Group;
      protected _direct_26_group: eui.Group;
      protected _direct_27_group: eui.Group;
      protected _direct_28_group: eui.Group;
      protected _direct_29_group: eui.Group;
      protected _direct_30_group: eui.Group;
      protected _direct_31_group: eui.Group;
      protected _direct_32_group: eui.Group;
      protected _direct_33_group: eui.Group;
      protected _direct_34_group: eui.Group;
      protected _direct_35_group: eui.Group;
      protected _direct_36_group: eui.Group;
      protected _separate_1_2_group: eui.Group;
      protected _separate_2_3_group: eui.Group;
      protected _separate_4_5_group: eui.Group;
      protected _separate_5_6_group: eui.Group;
      protected _separate_7_8_group: eui.Group;
      protected _separate_8_9_group: eui.Group;
      protected _separate_10_11_group: eui.Group;
      protected _separate_11_12_group: eui.Group;
      protected _separate_13_14_group: eui.Group;
      protected _separate_14_15_group: eui.Group;
      protected _separate_16_17_group: eui.Group;
      protected _separate_17_18_group: eui.Group;
      protected _separate_19_20_group: eui.Group;
      protected _separate_20_21_group: eui.Group;
      protected _separate_22_23_group: eui.Group;
      protected _separate_23_24_group: eui.Group;
      protected _separate_25_26_group: eui.Group;
      protected _separate_26_27_group: eui.Group;
      protected _separate_28_29_group: eui.Group;
      protected _separate_29_30_group: eui.Group;
      protected _separate_31_32_group: eui.Group;
      protected _separate_32_33_group: eui.Group;
      protected _separate_34_35_group: eui.Group;
      protected _separate_35_36_group: eui.Group;
      protected _separate_0_1_group: eui.Group;
      protected _separate_0_2_group: eui.Group;
      protected _separate_0_3_group: eui.Group;
      protected _separate_1_4_group: eui.Group;
      protected _separate_2_5_group: eui.Group;
      protected _separate_3_6_group: eui.Group;
      protected _separate_4_7_group: eui.Group;
      protected _separate_5_8_group: eui.Group;
      protected _separate_6_9_group: eui.Group;
      protected _separate_7_10_group: eui.Group;
      protected _separate_8_11_group: eui.Group;
      protected _separate_9_12_group: eui.Group;
      protected _separate_10_13_group: eui.Group;
      protected _separate_11_14_group: eui.Group;
      protected _separate_12_15_group: eui.Group;
      protected _separate_13_16_group: eui.Group;
      protected _separate_14_17_group: eui.Group;
      protected _separate_15_18_group: eui.Group;
      protected _separate_16_19_group: eui.Group;
      protected _separate_17_20_group: eui.Group;
      protected _separate_18_21_group: eui.Group;
      protected _separate_19_22_group: eui.Group;
      protected _separate_20_23_group: eui.Group;
      protected _separate_21_24_group: eui.Group;
      protected _separate_22_25_group: eui.Group;
      protected _separate_23_26_group: eui.Group;
      protected _separate_24_27_group: eui.Group;
      protected _separate_25_28_group: eui.Group;
      protected _separate_26_29_group: eui.Group;
      protected _separate_27_30_group: eui.Group;
      protected _separate_28_31_group: eui.Group;
      protected _separate_29_32_group: eui.Group;
      protected _separate_30_33_group: eui.Group;
      protected _separate_31_34_group: eui.Group;
      protected _separate_32_35_group: eui.Group;
      protected _separate_33_36_group: eui.Group;
      protected _street_1_2_3_group: eui.Group;
      protected _street_4_5_6_group: eui.Group;
      protected _street_7_8_9_group: eui.Group;
      protected _street_10_11_12_group: eui.Group;
      protected _street_13_14_15_group: eui.Group;
      protected _street_16_17_18_group: eui.Group;
      protected _street_19_20_21_group: eui.Group;
      protected _street_22_23_24_group: eui.Group;
      protected _street_25_26_27_group: eui.Group;
      protected _street_28_29_30_group: eui.Group;
      protected _street_31_32_33_group: eui.Group;
      protected _street_34_35_36_group: eui.Group;
      protected _street_0_1_2_group: eui.Group;
      protected _street_0_2_3_group: eui.Group;
      protected _corner_1_2_4_5_group: eui.Group;
      protected _corner_2_3_5_6_group: eui.Group;
      protected _corner_4_5_7_8_group: eui.Group;
      protected _corner_5_6_8_9_group: eui.Group;
      protected _corner_7_8_10_11_group: eui.Group;
      protected _corner_8_9_11_12_group: eui.Group;
      protected _corner_10_11_13_14_group: eui.Group;
      protected _corner_11_12_14_15_group: eui.Group;
      protected _corner_13_14_16_17_group: eui.Group;
      protected _corner_14_15_17_18_group: eui.Group;
      protected _corner_16_17_19_20_group: eui.Group;
      protected _corner_17_18_20_21_group: eui.Group;
      protected _corner_19_20_22_23_group: eui.Group;
      protected _corner_20_21_23_24_group: eui.Group;
      protected _corner_22_23_25_26_group: eui.Group;
      protected _corner_23_24_26_27_group: eui.Group;
      protected _corner_25_26_28_29_group: eui.Group;
      protected _corner_26_27_29_30_group: eui.Group;
      protected _corner_28_29_31_32_group: eui.Group;
      protected _corner_29_30_32_33_group: eui.Group;
      protected _corner_31_32_34_35_group: eui.Group;
      protected _corner_32_33_35_36_group: eui.Group;
      protected _corner_0_1_2_3_group: eui.Group;
      protected _line_1_6_group: eui.Group;
      protected _line_4_9_group: eui.Group;
      protected _line_7_12_group: eui.Group;
      protected _line_10_15_group: eui.Group;
      protected _line_13_18_group: eui.Group;
      protected _line_16_21_group: eui.Group;
      protected _line_19_24_group: eui.Group;
      protected _line_22_27_group: eui.Group;
      protected _line_25_30_group: eui.Group;
      protected _line_28_33_group: eui.Group;
      protected _line_31_36_group: eui.Group;
      protected _row_1_group: eui.Group;
      protected _row_2_group: eui.Group;
      protected _row_3_group: eui.Group;
      protected _dozen_1_12_group: eui.Group;
      protected _dozen_13_24_group: eui.Group;
      protected _dozen_25_36_group: eui.Group;
      protected _red_group: eui.Group;
      protected _black_group: eui.Group;
      protected _odd_group: eui.Group;
      protected _even_group: eui.Group;
      protected _small_group: eui.Group;
      protected _big_group: eui.Group;

      protected _direct_0_label: eui.Label;
      protected _direct_1_label: eui.Label;
      protected _direct_2_label: eui.Label;
      protected _direct_3_label: eui.Label;
      protected _direct_4_label: eui.Label;
      protected _direct_5_label: eui.Label;
      protected _direct_6_label: eui.Label;
      protected _direct_7_label: eui.Label;
      protected _direct_8_label: eui.Label;
      protected _direct_9_label: eui.Label;
      protected _direct_10_label: eui.Label;
      protected _direct_11_label: eui.Label;
      protected _direct_12_label: eui.Label;
      protected _direct_13_label: eui.Label;
      protected _direct_14_label: eui.Label;
      protected _direct_15_label: eui.Label;
      protected _direct_16_label: eui.Label;
      protected _direct_17_label: eui.Label;
      protected _direct_18_label: eui.Label;
      protected _direct_19_label: eui.Label;
      protected _direct_20_label: eui.Label;
      protected _direct_21_label: eui.Label;
      protected _direct_22_label: eui.Label;
      protected _direct_23_label: eui.Label;
      protected _direct_24_label: eui.Label;
      protected _direct_25_label: eui.Label;
      protected _direct_26_label: eui.Label;
      protected _direct_27_label: eui.Label;
      protected _direct_28_label: eui.Label;
      protected _direct_29_label: eui.Label;
      protected _direct_30_label: eui.Label;
      protected _direct_31_label: eui.Label;
      protected _direct_32_label: eui.Label;
      protected _direct_33_label: eui.Label;
      protected _direct_34_label: eui.Label;
      protected _direct_35_label: eui.Label;
      protected _direct_36_label: eui.Label;
      protected _separate_1_2_label: eui.Label;
      protected _separate_2_3_label: eui.Label;
      protected _separate_4_5_label: eui.Label;
      protected _separate_5_6_label: eui.Label;
      protected _separate_7_8_label: eui.Label;
      protected _separate_8_9_label: eui.Label;
      protected _separate_10_11_label: eui.Label;
      protected _separate_11_12_label: eui.Label;
      protected _separate_13_14_label: eui.Label;
      protected _separate_14_15_label: eui.Label;
      protected _separate_16_17_label: eui.Label;
      protected _separate_17_18_label: eui.Label;
      protected _separate_19_20_label: eui.Label;
      protected _separate_20_21_label: eui.Label;
      protected _separate_22_23_label: eui.Label;
      protected _separate_23_24_label: eui.Label;
      protected _separate_25_26_label: eui.Label;
      protected _separate_26_27_label: eui.Label;
      protected _separate_28_29_label: eui.Label;
      protected _separate_29_30_label: eui.Label;
      protected _separate_31_32_label: eui.Label;
      protected _separate_32_33_label: eui.Label;
      protected _separate_34_35_label: eui.Label;
      protected _separate_35_36_label: eui.Label;
      protected _separate_0_1_label: eui.Label;
      protected _separate_0_2_label: eui.Label;
      protected _separate_0_3_label: eui.Label;
      protected _separate_1_4_label: eui.Label;
      protected _separate_2_5_label: eui.Label;
      protected _separate_3_6_label: eui.Label;
      protected _separate_4_7_label: eui.Label;
      protected _separate_5_8_label: eui.Label;
      protected _separate_6_9_label: eui.Label;
      protected _separate_7_10_label: eui.Label;
      protected _separate_8_11_label: eui.Label;
      protected _separate_9_12_label: eui.Label;
      protected _separate_10_13_label: eui.Label;
      protected _separate_11_14_label: eui.Label;
      protected _separate_12_15_label: eui.Label;
      protected _separate_13_16_label: eui.Label;
      protected _separate_14_17_label: eui.Label;
      protected _separate_15_18_label: eui.Label;
      protected _separate_16_19_label: eui.Label;
      protected _separate_17_20_label: eui.Label;
      protected _separate_18_21_label: eui.Label;
      protected _separate_19_22_label: eui.Label;
      protected _separate_20_23_label: eui.Label;
      protected _separate_21_24_label: eui.Label;
      protected _separate_22_25_label: eui.Label;
      protected _separate_23_26_label: eui.Label;
      protected _separate_24_27_label: eui.Label;
      protected _separate_25_28_label: eui.Label;
      protected _separate_26_29_label: eui.Label;
      protected _separate_27_30_label: eui.Label;
      protected _separate_28_31_label: eui.Label;
      protected _separate_29_32_label: eui.Label;
      protected _separate_30_33_label: eui.Label;
      protected _separate_31_34_label: eui.Label;
      protected _separate_32_35_label: eui.Label;
      protected _separate_33_36_label: eui.Label;
      protected _street_1_2_3_label: eui.Label;
      protected _street_4_5_6_label: eui.Label;
      protected _street_7_8_9_label: eui.Label;
      protected _street_10_11_12_label: eui.Label;
      protected _street_13_14_15_label: eui.Label;
      protected _street_16_17_18_label: eui.Label;
      protected _street_19_20_21_label: eui.Label;
      protected _street_22_23_24_label: eui.Label;
      protected _street_25_26_27_label: eui.Label;
      protected _street_28_29_30_label: eui.Label;
      protected _street_31_32_33_label: eui.Label;
      protected _street_34_35_36_label: eui.Label;
      protected _street_0_1_2_label: eui.Label;
      protected _street_0_2_3_label: eui.Label;
      protected _corner_1_2_4_5_label: eui.Label;
      protected _corner_2_3_5_6_label: eui.Label;
      protected _corner_4_5_7_8_label: eui.Label;
      protected _corner_5_6_8_9_label: eui.Label;
      protected _corner_7_8_10_11_label: eui.Label;
      protected _corner_8_9_11_12_label: eui.Label;
      protected _corner_10_11_13_14_label: eui.Label;
      protected _corner_11_12_14_15_label: eui.Label;
      protected _corner_13_14_16_17_label: eui.Label;
      protected _corner_14_15_17_18_label: eui.Label;
      protected _corner_16_17_19_20_label: eui.Label;
      protected _corner_17_18_20_21_label: eui.Label;
      protected _corner_19_20_22_23_label: eui.Label;
      protected _corner_20_21_23_24_label: eui.Label;
      protected _corner_22_23_25_26_label: eui.Label;
      protected _corner_23_24_26_27_label: eui.Label;
      protected _corner_25_26_28_29_label: eui.Label;
      protected _corner_26_27_29_30_label: eui.Label;
      protected _corner_28_29_31_32_label: eui.Label;
      protected _corner_29_30_32_33_label: eui.Label;
      protected _corner_31_32_34_35_label: eui.Label;
      protected _corner_32_33_35_36_label: eui.Label;
      protected _corner_0_1_2_3_label: eui.Label;
      protected _line_1_6_label: eui.Label;
      protected _line_4_9_label: eui.Label;
      protected _line_7_12_label: eui.Label;
      protected _line_10_15_label: eui.Label;
      protected _line_13_18_label: eui.Label;
      protected _line_16_21_label: eui.Label;
      protected _line_19_24_label: eui.Label;
      protected _line_22_27_label: eui.Label;
      protected _line_25_30_label: eui.Label;
      protected _line_28_33_label: eui.Label;
      protected _line_31_36_label: eui.Label;
      protected _row_1_label: ui.RunTimeLabel;
      protected _row_2_label: ui.RunTimeLabel;
      protected _row_3_label: ui.RunTimeLabel;
      protected _dozen_1_12_label: ui.RunTimeLabel;
      protected _dozen_13_24_label: ui.RunTimeLabel;
      protected _dozen_25_36_label: ui.RunTimeLabel;
      protected _red_label: eui.Label;
      protected _black_label: eui.Label;
      protected _odd_label: ui.RunTimeLabel;
      protected _even_label: ui.RunTimeLabel;
      protected _small_label: ui.RunTimeLabel;
      protected _big_label: ui.RunTimeLabel;

      protected _groupMapping: {};
      protected _groupHoverImageMapping: {};

      protected overCount: { [s: string]: number } = {};

      constructor() {
        super();
        this._betField = ro.BetField;
      }

      protected createMapping() {
        super.createMapping();
        this._groupMapping = {};
        this._groupMapping[ro.BetField.DIRECT_0] = this._direct_0_group;
        this._groupMapping[ro.BetField.DIRECT_1] = this._direct_1_group;
        this._groupMapping[ro.BetField.DIRECT_2] = this._direct_2_group;
        this._groupMapping[ro.BetField.DIRECT_3] = this._direct_3_group;
        this._groupMapping[ro.BetField.DIRECT_4] = this._direct_4_group;
        this._groupMapping[ro.BetField.DIRECT_5] = this._direct_5_group;
        this._groupMapping[ro.BetField.DIRECT_6] = this._direct_6_group;
        this._groupMapping[ro.BetField.DIRECT_7] = this._direct_7_group;
        this._groupMapping[ro.BetField.DIRECT_8] = this._direct_8_group;
        this._groupMapping[ro.BetField.DIRECT_9] = this._direct_9_group;
        this._groupMapping[ro.BetField.DIRECT_10] = this._direct_10_group;
        this._groupMapping[ro.BetField.DIRECT_11] = this._direct_11_group;
        this._groupMapping[ro.BetField.DIRECT_12] = this._direct_12_group;
        this._groupMapping[ro.BetField.DIRECT_13] = this._direct_13_group;
        this._groupMapping[ro.BetField.DIRECT_14] = this._direct_14_group;
        this._groupMapping[ro.BetField.DIRECT_15] = this._direct_15_group;
        this._groupMapping[ro.BetField.DIRECT_16] = this._direct_16_group;
        this._groupMapping[ro.BetField.DIRECT_17] = this._direct_17_group;
        this._groupMapping[ro.BetField.DIRECT_18] = this._direct_18_group;
        this._groupMapping[ro.BetField.DIRECT_19] = this._direct_19_group;
        this._groupMapping[ro.BetField.DIRECT_20] = this._direct_20_group;
        this._groupMapping[ro.BetField.DIRECT_21] = this._direct_21_group;
        this._groupMapping[ro.BetField.DIRECT_22] = this._direct_22_group;
        this._groupMapping[ro.BetField.DIRECT_23] = this._direct_23_group;
        this._groupMapping[ro.BetField.DIRECT_24] = this._direct_24_group;
        this._groupMapping[ro.BetField.DIRECT_25] = this._direct_25_group;
        this._groupMapping[ro.BetField.DIRECT_26] = this._direct_26_group;
        this._groupMapping[ro.BetField.DIRECT_27] = this._direct_27_group;
        this._groupMapping[ro.BetField.DIRECT_28] = this._direct_28_group;
        this._groupMapping[ro.BetField.DIRECT_29] = this._direct_29_group;
        this._groupMapping[ro.BetField.DIRECT_30] = this._direct_30_group;
        this._groupMapping[ro.BetField.DIRECT_31] = this._direct_31_group;
        this._groupMapping[ro.BetField.DIRECT_32] = this._direct_32_group;
        this._groupMapping[ro.BetField.DIRECT_33] = this._direct_33_group;
        this._groupMapping[ro.BetField.DIRECT_34] = this._direct_34_group;
        this._groupMapping[ro.BetField.DIRECT_35] = this._direct_35_group;
        this._groupMapping[ro.BetField.DIRECT_36] = this._direct_36_group;

        this._groupMapping[ro.BetField.ROW_1] = this._row_1_group;
        this._groupMapping[ro.BetField.ROW_2] = this._row_2_group;
        this._groupMapping[ro.BetField.ROW_3] = this._row_3_group;
        this._groupMapping[ro.BetField.DOZEN_1_12] = this._dozen_1_12_group;
        this._groupMapping[ro.BetField.DOZEN_13_24] = this._dozen_13_24_group;
        this._groupMapping[ro.BetField.DOZEN_25_36] = this._dozen_25_36_group;
        this._groupMapping[ro.BetField.RED] = this._red_group;
        this._groupMapping[ro.BetField.BLACK] = this._black_group;
        this._groupMapping[ro.BetField.ODD] = this._odd_group;
        this._groupMapping[ro.BetField.EVEN] = this._even_group;
        this._groupMapping[ro.BetField.SMALL] = this._small_group;
        this._groupMapping[ro.BetField.BIG] = this._big_group;

        this._groupHoverImageMapping = {};
        Object.keys(we.ro.BETFIELD_IMAGE_MAPPING).map(value => {
          this._groupHoverImageMapping[value] = we.ro.BETFIELD_IMAGE_MAPPING[value];
        });

        this._row_1_label.renderText = () => i18n.t('roulette.row_1');
        this._row_2_label.renderText = () => i18n.t('roulette.row_2');
        this._row_3_label.renderText = () => i18n.t('roulette.row_3');
        this._dozen_1_12_label.renderText = () => i18n.t('roulette.dozen_1_12');
        this._dozen_13_24_label.renderText = () => i18n.t('roulette.dozen_13_24');
        this._dozen_25_36_label.renderText = () => i18n.t('roulette.dozen_25_36');
        this._odd_label.renderText = () => i18n.t('roulette.odd');
        this._even_label.renderText = () => i18n.t('roulette.even');
        this._small_label.renderText = () => i18n.t('roulette.small');
        this._big_label.renderText = () => i18n.t('roulette.big');
      }

      public onRollover(fieldName: string) {
        const group = this._groupMapping[fieldName];

        let image = group.getChildByName('image');
        if (!this.overCount[fieldName]) {
          this.overCount[fieldName] = 0;
        }
        this.overCount[fieldName]++;
        if (this.overCount[fieldName] > 0 && !image) {
          image = new eui.Image();
          image.name = 'image';
          image.source = this._groupHoverImageMapping[fieldName];
          group.addChildAt(image, 0);
        }
      }

      public onRollout(fieldName: string) {
        const group = this._groupMapping[fieldName];
        if (!group) {
          return;
        }
        if (!this.overCount[fieldName]) {
          this.overCount[fieldName] = 0;
        }
        this.overCount[fieldName]--;
        if (this.overCount[fieldName] <= 0) {
          this.overCount[fieldName] = 0;
          const image = group.getChildByName('image');
          if (image) {
            group.removeChild(image);
          }
        }
      }

      public clearAllHighlights() {
        Object.keys(ro.BetField).map(value => {
          this.onRollout(value);
        });
      }

      public async flashFields(fieldName: string) {
        const winningFields = ro.getWinningFields(fieldName);
        const initRectPromises = [];
        // init dim rects
        for (const field of Object.keys(this._groupMapping)) {
          const group = this._groupMapping[field];
          const isWin = winningFields.indexOf(field) >= 0;
          // try remove existing
          let rect = group.getChildByName('dim');
          if (rect) {
            group.removeChild(rect);
          }
          rect = new eui.Rect();
          rect.name = 'dim';
          rect.alpha = 0;
          rect.fillColor = isWin ? 0xffffff : 0x000000;
          rect.percentWidth = 100;
          rect.percentHeight = 100;
          group.addChildAt(rect, 1);
          const promise = new Promise(resolve => {
            egret.Tween.get(rect)
              .to({ alpha: isWin ? 0 : 0.25 }, 125)
              .call(resolve);
          });
          initRectPromises.push(promise);
        }
        await Promise.all(initRectPromises);
        // start flashing
        let run = 1;
        const tick = async () => {
          // end flashing
          if (run >= 6) {
            const fadeOutPromises = [];
            for (const field of Object.keys(this._groupMapping)) {
              const group = this._groupMapping[field];
              const rect = group.getChildByName('dim');
              const promise = new Promise(resolve => {
                egret.Tween.get(rect)
                  .to({ alpha: 0 }, 125)
                  .call(() => {
                    if (rect.parent) {
                      rect.parent.removeChild(rect);
                    }
                    resolve();
                  });
              });
              fadeOutPromises.push(promise);
            }
            await Promise.all(fadeOutPromises);
            return;
          }
          const tickFlashPromises = [];
          for (const field of winningFields) {
            const group = this._groupMapping[field];
            const rect = group.getChildByName('dim');
            const prom = new Promise(resolve => {
              const alpha = run % 2 === 1 ? 0.25 : 0;
              egret.Tween.get(rect)
                .to({ alpha }, 125)
                .call(resolve);
            });
            tickFlashPromises.push(prom);
          }
          await Promise.all(tickFlashPromises);
          run += 1;
          setTimeout(tick, 300);
        };
        setTimeout(tick, 300);
      }
    }
  }
}
